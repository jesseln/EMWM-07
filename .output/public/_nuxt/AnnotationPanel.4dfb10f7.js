import{C as ge,D as xe,h as n,r as w,E as H,f as V,G as Se,v as te,_ as ke,q as Ce,o as E,c as z,a as t,l as B,t as T,n as D,d as Y,F,i as N,A as U,H as K,I as Q,j as G,J as Ee,p as ze,e as Oe}from"./entry.de7ae5fc.js";function se(e){return ge()?(xe(e),!0):!1}function oe(e){return typeof e=="function"?e():n(e)}const ne=typeof window<"u",q=()=>{},Ie=Ae();function Ae(){var e;return ne&&((e=window==null?void 0:window.navigator)==null?void 0:e.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent)}function A(e){var u;const d=oe(e);return(u=d==null?void 0:d.$el)!=null?u:d}const $=ne?window:void 0;function k(...e){let u,d,i,v;if(typeof e[0]=="string"||Array.isArray(e[0])?([d,i,v]=e,u=$):[u,d,i,v]=e,!u)return q;Array.isArray(d)||(d=[d]),Array.isArray(i)||(i=[i]);const g=[],h=()=>{g.forEach(p=>p()),g.length=0},m=(p,y,a,s)=>(p.addEventListener(y,a,s),()=>p.removeEventListener(y,a,s)),c=H(()=>[A(u),oe(v)],([p,y])=>{h(),p&&g.push(...d.flatMap(a=>i.map(s=>m(p,a,s,y))))},{immediate:!0,flush:"post"}),_=()=>{c(),h()};return se(_),_}let Z=!1;function jt(e,u,d={}){const{window:i=$,ignore:v=[],capture:g=!0,detectIframe:h=!1}=d;if(!i)return;Ie&&!Z&&(Z=!0,Array.from(i.document.body.children).forEach(a=>a.addEventListener("click",q)),i.document.documentElement.addEventListener("click",q));let m=!0;const c=a=>v.some(s=>{if(typeof s=="string")return Array.from(i.document.querySelectorAll(s)).some(S=>S===a.target||a.composedPath().includes(S));{const S=A(s);return S&&(a.target===S||a.composedPath().includes(S))}}),p=[k(i,"click",a=>{const s=A(e);if(!(!s||s===a.target||a.composedPath().includes(s))){if(a.detail===0&&(m=!c(a)),!m){m=!0;return}u(a)}},{passive:!0,capture:g}),k(i,"pointerdown",a=>{const s=A(e);s&&(m=!a.composedPath().includes(s)&&!c(a))},{passive:!0}),h&&k(i,"blur",a=>{setTimeout(()=>{var s;const S=A(e);((s=i.document.activeElement)==null?void 0:s.tagName)==="IFRAME"&&!(S!=null&&S.contains(i.document.activeElement))&&u(a)},0)})].filter(Boolean);return()=>p.forEach(a=>a())}function De(){const e=w(!1);return Se()&&te(()=>{e.value=!0}),e}function Pe(e){const u=De();return V(()=>(u.value,!!e()))}var ee=Object.getOwnPropertySymbols,Be=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable,Re=(e,u)=>{var d={};for(var i in e)Be.call(e,i)&&u.indexOf(i)<0&&(d[i]=e[i]);if(e!=null&&ee)for(var i of ee(e))u.indexOf(i)<0&&$e.call(e,i)&&(d[i]=e[i]);return d};function Me(e,u,d={}){const i=d,{window:v=$}=i,g=Re(i,["window"]);let h;const m=Pe(()=>v&&"ResizeObserver"in v),c=()=>{h&&(h.disconnect(),h=void 0)},_=V(()=>Array.isArray(e)?e.map(a=>A(a)):[A(e)]),p=H(_,a=>{if(c(),m.value&&v){h=new ResizeObserver(u);for(const s of a)s&&h.observe(s,g)}},{immediate:!0,flush:"post",deep:!0}),y=()=>{c(),p()};return se(y),{isSupported:m,stop:y}}function Xe(e,u={width:0,height:0},d={}){const{window:i=$,box:v="content-box"}=d,g=V(()=>{var c,_;return(_=(c=A(e))==null?void 0:c.namespaceURI)==null?void 0:_.includes("svg")}),h=w(u.width),m=w(u.height);return Me(e,([c])=>{const _=v==="border-box"?c.borderBoxSize:v==="content-box"?c.contentBoxSize:c.devicePixelContentBoxSize;if(i&&g.value){const p=A(e);if(p){const y=i.getComputedStyle(p);h.value=Number.parseFloat(y.width),m.value=Number.parseFloat(y.height)}}else if(_){const p=Array.isArray(_)?_:[_];h.value=p.reduce((y,{inlineSize:a})=>y+a,0),m.value=p.reduce((y,{blockSize:a})=>y+a,0)}else h.value=c.contentRect.width,m.value=c.contentRect.height},d),H(()=>A(e),c=>{h.value=c?u.width:0,m.value=c?u.height:0}),{width:h,height:m}}const Ye={page:e=>[e.pageX,e.pageY],client:e=>[e.clientX,e.clientY],screen:e=>[e.screenX,e.screenY],movement:e=>e instanceof Touch?null:[e.movementX,e.movementY]};function We(e={}){const{type:u="page",touch:d=!0,resetOnTouchEnds:i=!1,initialValue:v={x:0,y:0},window:g=$,target:h=g,eventFilter:m}=e,c=w(v.x),_=w(v.y),p=w(null),y=typeof u=="function"?u:Ye[u],a=f=>{const I=y(f);I&&([c.value,_.value]=I,p.value="mouse")},s=f=>{if(f.touches.length>0){const I=y(f.touches[0]);I&&([c.value,_.value]=I,p.value="touch")}},S=()=>{c.value=v.x,_.value=v.y},x=m?f=>m(()=>a(f),{}):f=>a(f),O=m?f=>m(()=>s(f),{}):f=>s(f);if(h){const f={passive:!0};k(h,["mousemove","dragover"],x,f),d&&u!=="movement"&&(k(h,["touchstart","touchmove"],O,f),i&&k(h,"touchend",S,f))}return{x:c,y:_,sourceType:p}}function Le(e={}){const{touch:u=!0,drag:d=!0,initialValue:i=!1,window:v=$}=e,g=w(i),h=w(null);if(!v)return{pressed:g,sourceType:h};const m=p=>()=>{g.value=!0,h.value=p},c=()=>{g.value=!1,h.value=null},_=V(()=>A(e.target)||v);return k(_,"mousedown",m("mouse"),{passive:!0}),k(v,"mouseleave",c,{passive:!0}),k(v,"mouseup",c,{passive:!0}),d&&(k(_,"dragstart",m("mouse"),{passive:!0}),k(v,"drop",c,{passive:!0}),k(v,"dragend",c,{passive:!0})),u&&(k(_,"touchstart",m("touch"),{passive:!0}),k(v,"touchend",c,{passive:!0}),k(v,"touchcancel",c,{passive:!0})),{pressed:g,sourceType:h}}function Ft({window:e=$}={}){if(!e)return{x:w(0),y:w(0)};const u=w(e.scrollX),d=w(e.scrollY);return k(e,"scroll",()=>{u.value=e.scrollX,d.value=e.scrollY},{capture:!1,passive:!0}),{x:u,y:d}}const b=e=>(ze("data-v-d6c42510"),e=e(),Oe(),e),Te={id:"draw"},He={key:0,class:"welcome-bg"},Ve={class:"welcome"},je=b(()=>t("h1",{class:"fade-up"},"Annotate the Library",-1)),Fe=b(()=>t("h2",{class:"fade-up"}," Create annotations using the draw toolbar ",-1)),Ne=b(()=>t("a",{href:"//twitter.com/lewitje",target:"blank",title:"Lewi Hussey on Twitter",class:"fade-up"},"@emw_marginalia",-1)),Ue={class:"app-wrapper"},Ge=b(()=>t("div",{class:"cursor",id:"cursor"},null,-1)),qe={class:"controls"},Je={class:"btn-row"},Ke={class:"history",title:"history"},Qe={class:"btn-row"},Ze=b(()=>t("i",{class:"ion ion-reply"},null,-1)),et=[Ze],tt=b(()=>t("i",{class:"ion ion-trash-a"},null,-1)),st=[tt],ot={class:"btn-row"},nt=b(()=>t("i",{class:"ion ion-android-create"},null,-1)),lt=[nt],it={key:0,class:"popup"},at=b(()=>t("div",{class:"popup-title"}," Options ",-1)),rt=b(()=>t("i",{class:"ion ion-arrow-right-c"},null,-1)),ut=b(()=>t("i",{class:"ion ion-arrow-up-c"},null,-1)),ct=b(()=>t("i",{class:"ion ion-wand"},null,-1)),dt=b(()=>t("i",{class:"ion ion-shuffle"},null,-1)),vt={class:"btn-row"},ht=b(()=>t("i",{class:"ion ion-android-radio-button-on"},null,-1)),pt={class:"size-icon"},ft={key:0,class:"popup"},mt=b(()=>t("div",{class:"popup-title"}," Brush size ",-1)),_t={class:"size-item"},yt=["value"],wt={class:"btn-row"},bt=b(()=>t("i",{class:"ion ion-android-color-palette"},null,-1)),gt={key:0,class:"popup"},xt=b(()=>t("div",{class:"popup-title"}," Brush color ",-1)),St={class:"color-item"},kt=["value"],Ct={class:"btn-row"},Et=b(()=>t("i",{class:"ion ion-android-cloud-outline"},null,-1)),zt=[Et],Ot={key:0,class:"popup"},It=b(()=>t("div",{class:"popup-title"}," Save your design ",-1)),At={class:"form"},Dt={key:0,class:"text-faded"},Pt=b(()=>t("i",null," Min 3 characters ",-1)),Bt=[Pt],$t={class:"text-faded"},Rt={key:0,class:"saves"},Mt=b(()=>t("div",{class:"popup-title"}," Load a save ",-1)),Xt={class:"save-item"},Yt=["onClick"],Wt={class:"btn-row"},Lt=b(()=>t("i",{class:"ion ion-heart"},null,-1)),Tt=[Lt],Ht={__name:"AnnotationPanel",setup(e){const u=w(null),{width:d,height:i}=Xe(u),v=d,g=i,{x:h,y:m,sourceType:c}=We(),{pressed:_}=Le(),p=h,y=m,a=_,s=w([]),S=w("#fff281"),x=w({showColor:!1,showSize:!1,showWelcome:!0,showSave:!1,showOptions:!1}),O=w({restrictY:!1,restrictX:!1}),f=w({name:"",saveItems:[]}),I=w(6),le=w(["#d4f713","#13f7ab","#13f3f7","#13c5f7","#138cf7","#1353f7","#2d13f7","#7513f7","#a713f7","#d413f7","#f713e0","#f71397","#f7135b","#f71313","#f76213","#f79413","#fff281"]),ie=w([6,12,24,48]),ae=()=>{s.value.splice(s.value.length-2,1),R()},re=()=>{s.value=[],R()},ue=()=>{let l=[];s.value.forEach((o,r)=>{(r%6!==1||o.isDummy)&&l.push(o)}),s.value=l,R()},ce=()=>{s.value.forEach((l,o)=>{l.r+=Math.sin(o*20)*5}),s.value=de(s.value),R()},de=l=>{let o=[];l.forEach((r,X)=>{if(!r.isDummy){let we=o.length,be=Math.floor(we*Math.random());o.splice(be,0,r)}});for(let r=0;r<o.length;r++)r%20===1&&o.push(J());return o},ve=()=>{if(f.value.name.length>2){let l={history:s.value.slice(),name:f.value.name};f.value.saveItems.push(l),f.value.name=""}},he=l=>{s.value=l.history.slice(),R()};let P,C,M=!1,W=0,L=0;function pe(){!a.value&&M?(_e(),M=!1):a.value&&!M&&(M=!0)}function fe(){let l=document.getElementById("cursor");if(l.style.transform=`translate(${p.value-10}px, ${y.value-10}px)`,M){W=W,L=L,O.value.restrictX||(W=p.value),O.value.restrictY||(L=y.value);let o={isDummy:!1,x:W,y:L,c:S.value,r:I.value};s.value.push(o),j(o,s.value.length)}}function me(){P.width=v.value,P.height=g.value}function J(){let l=s.value[s.value.length-1];return{isDummy:!0,x:l!=null&&l.x?l.x:p.value,y:l!=null&&l.y?l.y:y.value,c:null,r:null}}function _e(){let l=J();s.value.push(l),j(l,s.value.length)}function R(){if(C.clearRect(0,0,P.width,P.height),ye(),!s.value.length)return!0;s.value.forEach((l,o)=>{j(l,o)})}function ye(){let l=50;C.fillStyle="rgba(0, 0, 0, .2)";for(let o=0;o*l<P.width;o++)for(let r=0;r*l<P.height;r++)o>0&&r>0&&(C.beginPath(),C.rect(o*l,r*l,2,2),C.fill())}function j(l,o){C.lineCap="round",C.lineJoin="round",C.strokeStyle=l.c,C.lineWidth=l.r;let r=s.value[o-2];if(o<2)return!1;!l.isDummy&&!s.value[o-1].isDummy&&!r.isDummy?(C.beginPath(),C.moveTo(r.x,r.y),C.lineTo(l.x,l.y),C.stroke()):l.isDummy}return te(()=>{P=document.getElementById("canvas"),C=document.getElementById("canvas").getContext("2d"),Ce(()=>{fe(),pe()}),H([v,g],()=>{me(),R()},{immediate:!0})}),(l,o)=>(E(),z("div",Te,[n(x).showWelcome?(E(),z("div",He,[t("div",Ve,[je,Fe,Ne,t("span",{class:"btn fade-up",title:"Close",onClick:o[0]||(o[0]=r=>n(x).showWelcome=!1)}," Click here to be begin ")])])):B("",!0),t("div",Ue,[t("canvas",{id:"canvas",ref_key:"container",ref:u},null,512),Ge,t("div",qe,[t("div",Je,[t("div",Ke,T(n(s).length),1)]),t("div",Qe,[t("button",{type:"button",onClick:ae,class:D({disabled:!n(s).length}),title:"Undo"},et,2),t("button",{type:"button",onClick:re,class:D({disabled:!n(s).length}),title:"Clear all"},st,2)]),t("div",ot,[t("button",{title:"Brush options",onClick:o[1]||(o[1]=r=>n(x).showOptions=!n(x).showOptions)},lt),n(x).showOptions?(E(),z("div",it,[at,t("button",{title:"Restrict movement vertical",onClick:o[2]||(o[2]=r=>{n(O).restrictY=!n(O).restrictY,n(O).restrictX=!1}),class:D({active:n(O).restrictY})},[rt,Y(" Restrict vertical ")],2),t("button",{title:"Restrict movement horizontal",onClick:o[3]||(o[3]=r=>{n(O).restrictX=!n(O).restrictX,n(O).restrictY=!1}),class:D({active:n(O).restrictX})},[ut,Y(" Restrict horizontal ")],2),t("button",{type:"button",onClick:ue,class:D({disabled:!n(s).length}),title:"Simplify paths"},[ct,Y(" Simplify paths ")],2),t("button",{type:"button",onClick:ce,class:D({disabled:!n(s).length}),title:"Go nutz"},[dt,Y(" Go nutz ")],2)])):B("",!0)]),t("div",vt,[t("button",{title:"Pick a brush size",onClick:o[4]||(o[4]=r=>n(x).showSize=!n(x).showSize),class:D({active:n(x).showSize})},[ht,t("span",pt,T(n(I)),1)],2),n(x).showSize?(E(),z("div",ft,[mt,(E(!0),z(F,null,N(n(ie),r=>(E(),z("label",_t,[U(t("input",{type:"radio",name:"size","onUpdate:modelValue":o[5]||(o[5]=X=>Q(I)?I.value=X:null),value:r},null,8,yt),[[K,n(I)]]),t("span",{class:"size",style:G({width:r+"px",height:r+"px"})},null,4)]))),256))])):B("",!0)]),t("div",wt,[t("button",{title:"Pick a color",onClick:o[6]||(o[6]=r=>n(x).showColor=!n(x).showColor),class:D({active:n(x).showColor})},[bt,t("span",{class:"color-icon",style:G({backgroundColor:n(S)})},null,4)],2),n(x).showColor?(E(),z("div",gt,[xt,(E(!0),z(F,null,N(n(le),r=>(E(),z("label",St,[U(t("input",{type:"radio",name:"color","onUpdate:modelValue":o[7]||(o[7]=X=>Q(S)?S.value=X:null),value:r},null,8,kt),[[K,n(S)]]),t("span",{class:D("color color-"+r),style:G({backgroundColor:r})},null,6)]))),256))])):B("",!0)]),t("div",Ct,[t("button",{title:"Save",onClick:o[8]||(o[8]=r=>n(x).showSave=!n(x).showSave)},zt),n(x).showSave?(E(),z("div",Ot,[It,t("div",At,[U(t("input",{type:"text",placeholder:"Save name","onUpdate:modelValue":o[9]||(o[9]=r=>n(f).name=r)},null,512),[[Ee,n(f).name]]),n(f).name.length<3?(E(),z("div",Dt,Bt)):B("",!0),t("span",{class:"btn",onClick:ve},[Y(" Save as "),t("span",$t,T(n(f).name),1)])]),n(f).saveItems.length?(E(),z("div",Rt,[Mt,(E(!0),z(F,null,N(n(f).saveItems,r=>(E(),z("div",Xt,[t("h3",null,T(r.name),1),t("span",{class:"btn",onClick:X=>he(r)},"load",8,Yt)]))),256))])):B("",!0)])):B("",!0)]),t("div",Wt,[t("button",{onClick:o[10]||(o[10]=r=>n(x).showWelcome=!0),title:"Made by Lewi"},Tt)])])])]))}},Nt=ke(Ht,[["__scopeId","data-v-d6c42510"]]);export{Nt as _,jt as o,Ft as u};
